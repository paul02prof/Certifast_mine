<!-- templates/certifications/partials/filters.html -->
<!-- templates/certifications/partials/filters.html -->
<div class="bg-base-200 p-2  w-full rounded-lg shadow-sm mb-8">
     <h2 class="text-xl font-bold mb-0">Filtrer les certifications</h2>

    <!-- Boutons d'action -->
    <div class="flex justify-end space-x-5 pt-1">
      <button type="submit" class="btn btn-primary ">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd" />
        </svg>
        Appliquer les filtres
      </button>
      <a href="{% url 'certification_list' %}" class="btn btn-outline">
        Réinitialiser
      </a>
    </div>
 <form method="get" id="filter-form" class="space-y-6">

    <!-- Catégories -->
    <div>
      <label class="label">
        <span class="label-text font-medium">Catégories</span>
      </label>
      <button type="button" class="btn btn-sm btn-outline toggle-filter-btn" data-target="category-options">
        Afficher les catégories
      </button>
      <div id="category-options" class="hidden flex flex-wrap gap-2 mt-2 mb-2">
        {% for category in all_categories %}
        <button type="button"
                class="filter-btn category-btn btn btn-sm {% if request.GET.category == category.id|stringformat:'s' %}btn-primary{% else %}btn-outline{% endif %}"
                data-filter="category"
                data-value="{{ category.id }}">
          {{ category.name }}
        </button>
        {% endfor %}
      </div>
      <input type="hidden" name="category" id="category-input" value="{{ request.GET.category }}">
    </div>

    <!-- Institutions -->
    <div>
      <label class="label">
        <span class="label-text font-medium">Institutions</span>
      </label>
      <button type="button" class="btn btn-sm btn-outline toggle-filter-btn" data-target="institution-options">
        Afficher les institutions
      </button>
      <div id="institution-options" class="hidden flex flex-wrap gap-2 mt-2 mb-2">
        {% for institution in all_institutions %}
        <button type="button"
                class="filter-btn institution-btn btn btn-sm {% if request.GET.institution == institution.id|stringformat:'s' %}btn-primary{% else %}btn-outline{% endif %}"
                data-filter="institution"
                data-value="{{ institution.id }}">
          {{ institution.name }}
        </button>
        {% endfor %}
      </div>
      <input type="hidden" name="institution" id="institution-input" value="{{ request.GET.institution }}">
    </div>

    <!-- Langues -->
    <div>
      <label class="label">
        <span class="label-text font-medium">Langues</span>
      </label>
      <button type="button" class="btn btn-sm btn-outline toggle-filter-btn" data-target="language-options">
        Afficher les langues
      </button>
      <div id="language-options" class="hidden flex flex-wrap gap-2 mt-2 mb-2">
        {% for language in all_languages %}
        <button type="button"
                class="filter-btn language-btn btn btn-sm {% if request.GET.language == language.id|stringformat:'s' %}btn-primary{% else %}btn-outline{% endif %}"
                data-filter="language"
                data-value="{{ language.id }}">
          {{ language.name }}
        </button>
        {% endfor %}
      </div>
      <input type="hidden" name="language" id="language-input" value="{{ request.GET.language }}">
    </div>

    <!-- Sujets -->
    <div>
      <label class="label">
        <span class="label-text font-medium">Sujets</span>
      </label>
      <button type="button" class="btn btn-sm btn-outline toggle-filter-btn" data-target="topic-options">
        Afficher les sujets
      </button>
      <div id="topic-options" class="hidden flex flex-wrap gap-2 mt-2 mb-2">
        {% for topic in all_topics %}
        <button type="button"
                class="filter-btn topic-btn btn btn-sm {% if request.GET.topic == topic.id|stringformat:'s' %}btn-primary{% else %}btn-outline{% endif %}"
                data-filter="topic"
                data-value="{{ topic.id }}">
          {{ topic.name }}
        </button>
        {% endfor %}
      </div>
      <input type="hidden" name="topic" id="topic-input" value="{{ request.GET.topic }}">
    </div>


  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // Gère l'ouverture des filtres
  document.querySelectorAll('.toggle-filter-btn').forEach(button => {
    button.addEventListener('click', function () {
      const targetId = this.dataset.target;
      const targetEl = document.getElementById(targetId);
      if (targetEl.classList.contains('hidden')) {
        targetEl.classList.remove('hidden');
        this.textContent = 'Masquer les options';
      } else {
        targetEl.classList.add('hidden');
        this.textContent = 'Afficher les options';
      }
    });
  });

  // Gère les sélections des options de filtres
  document.querySelectorAll('.filter-btn').forEach(button => {
    button.addEventListener('click', function () {
      const filterType = this.dataset.filter;
      const value = this.dataset.value;
      const input = document.getElementById(`${filterType}-input`);

      if (input.value === value) {
        input.value = '';
        this.classList.remove('btn-primary');
        this.classList.add('btn-outline');
      } else {
        document.querySelectorAll(`.${filterType}-btn`).forEach(btn => {
          btn.classList.remove('btn-primary');
          btn.classList.add('btn-outline');
        });
        input.value = value;
        this.classList.remove('btn-outline');
        this.classList.add('btn-primary');
      }
    });
  });
});
</script>
